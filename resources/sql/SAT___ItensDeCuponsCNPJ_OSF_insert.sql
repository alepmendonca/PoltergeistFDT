INSERT INTO SAT_CUPOM_ITEM
SELECT
	CAST(IE AS BIGINT),
	CAST(EMISSAO AS DATE),
	CANCELADO,
	SUBSTRING(CUPOM, 4),
	CAST(SAT_SERIE AS INTEGER),
	CAST(ITEM AS INTEGER),
	COD_PRODUTO,
	CASE WHEN LENGTH(TRIM(GTIN)) = 0 THEN NULL ELSE GTIN::BIGINT END,
	DESC_PRODUTO,
	NCM.CODIGO,
	CFOP.CODIGO,
	UNIDADE,
	REPLACE(QUANTIDADE, ',', '.') :: numeric(10,2),
	REGRA,
	REPLACE(VALOR_UNITARIO, ',', '.') :: numeric(10,2),
	REPLACE(VALOR_PRODUTOS, ',', '.') :: numeric(10,2),
	CASE WHEN LENGTH(VALOR_DESCONTO) = 0 THEN 0.0 ELSE REPLACE(VALOR_DESCONTO, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(VALOR_OUTRO) = 0 THEN 0.0 ELSE REPLACE(VALOR_OUTRO, ',', '.') :: numeric(10,2) END,
	REPLACE(VALOR_ITEM, ',', '.') :: numeric(10,2),
	CASE WHEN LENGTH(VALOR_RAT_DESC) = 0 THEN 0.0 ELSE REPLACE(VALOR_RAT_DESC, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(VALOR_RAT_ACR) = 0 THEN 0.0 ELSE REPLACE(VALOR_RAT_ACR, ',', '.') :: numeric(10,2) END,
	ORIGEM,
	CST,
	CASE WHEN LENGTH(ICMS_ALIQUOTA) = 0 THEN 0.0 ELSE REPLACE(ICMS_ALIQUOTA, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(ICMS) = 0 THEN 0.0 ELSE REPLACE(ICMS, ',', '.') :: numeric(10,2) END,
	PIS_CST,
	CASE WHEN LENGTH(PIS_BC) = 0 THEN 0.0 ELSE REPLACE(PIS_BC, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(PIS_ALIQUOTA) = 0 THEN 0.0 ELSE REPLACE(PIS_ALIQUOTA, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(PIS) = 0 THEN 0.0 ELSE REPLACE(PIS, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(PIS_VENDIDA) = 0 THEN 0.0 ELSE REPLACE(PIS_VENDIDA, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(PIS_ALIQUOTA_VL) = 0 THEN 0.0 ELSE REPLACE(PIS_ALIQUOTA_VL, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(PIS_ST_BC) = 0 THEN 0.0 ELSE REPLACE(PIS_ST_BC, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(PIS_ST_ALIQUOTA) = 0 THEN 0.0 ELSE REPLACE(PIS_ST_ALIQUOTA, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(PIS_ST_VENDIDA) = 0 THEN 0.0 ELSE REPLACE(PIS_ST_VENDIDA, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(PIS_ST_ALIQUOTA_VL) = 0 THEN 0.0 ELSE REPLACE(PIS_ST_ALIQUOTA_VL, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(PIS_ST) = 0 THEN 0.0 ELSE REPLACE(PIS_ST, ',', '.') :: numeric(10,2) END,
	COFINS_CST,
	CASE WHEN LENGTH(COFINS_BC) = 0 THEN 0.0 ELSE REPLACE(COFINS_BC, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(COFINS_ALIQUOTA) = 0 THEN 0.0 ELSE REPLACE(COFINS_ALIQUOTA, ',', '.') :: numeric(10,2) END, 
	CASE WHEN LENGTH(COFINS) = 0 THEN 0.0 ELSE REPLACE(COFINS, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(COFINS_VENDIDA) = 0 THEN 0.0 ELSE REPLACE(COFINS_VENDIDA, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(COFINS_ALIQUOTA_VL) = 0 THEN 0.0 ELSE REPLACE(COFINS_ALIQUOTA_VL, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(COFINS_ST_BC) = 0 THEN 0.0 ELSE REPLACE(COFINS_ST_BC, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(COFINS_ST_ALIQUOTA) = 0 THEN 0.0 ELSE REPLACE(COFINS_ST_ALIQUOTA, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(COFINS_ST_VENDIDA) = 0 THEN 0.0 ELSE REPLACE(COFINS_ST_VENDIDA, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(COFINS_ST_ALIQUOTA_VL) = 0 THEN 0.0 ELSE REPLACE(COFINS_ST_ALIQUOTA_VL, ',', '.') :: numeric(10,2) END,
	CASE WHEN LENGTH(COFINS_ST) = 0 THEN 0.0 ELSE REPLACE(COFINS_ST, ',', '.') :: numeric(10,2) END,
	INFO_ADICIONAIS,
	SAT_CUPOM_ITEM_TEMP.DESCRICAO,
	DESCRICAO_TEXTO
FROM SAT_CUPOM_ITEM_TEMP
	LEFT JOIN CFOP ON CASE WHEN LENGTH(TRIM(SAT_CUPOM_ITEM_TEMP.CFOP)) < 4 THEN NULL ELSE SAT_CUPOM_ITEM_TEMP.CFOP::INTEGER END = CFOP.CODIGO
	LEFT JOIN NCM ON CASE WHEN LENGTH(REGEXP_REPLACE(SAT_CUPOM_ITEM_TEMP.NCM, '[^0-9]+', '', 'g')) < 7 THEN NULL ELSE REGEXP_REPLACE(SAT_CUPOM_ITEM_TEMP.NCM, '[^0-9]+', '', 'g')::INTEGER END = NCM.CODIGO;